#!/usr/bin/make -f

DEB_DH_INSTALL_SOURCEDIR = debian/tmp
INSTALL_DIR = $(CURDIR)/$(DEB_DH_INSTALL_SOURCEDIR)

include $(SWITCHLIGHT)/make/config.mk

SDKBUILD=$(SWITCHLIGHT)/components/powerpc/broadcom/sdk/sdk-5.10.0/sdk-5.10.0-release

%:
	dh $@

build-arch: 
	dh build-arch
	$(MAKE) -C $(SDKBUILD) libbroadcom-release.so.5.10 

clean:
	dh clean


SDK_DEV_INSTALL_DIR := $(INSTALL_DIR)/usr/src/libbroadcom-5.10-release-dev

override_dh_auto_install:
	mkdir -p $(INSTALL_DIR)/lib/modules $(INSTALL_DIR)/lib/$(DEB_HOST_GNU_TYPE)
	cp $(SDKBUILD)/linux-kernel-bde-5.10.ko $(INSTALL_DIR)/lib/modules
	cp $(SDKBUILD)/linux-user-bde-5.10.ko $(INSTALL_DIR)/lib/modules
	cp $(SDKBUILD)/libbroadcom-release.so.5.10 $(INSTALL_DIR)/lib/$(DEB_HOST_GNU_TYPE)/
	mkdir -p $(SDK_DEV_INSTALL_DIR)
	cp -R $(SDK)/include $(SDK_DEV_INSTALL_DIR)
	cp -R $(SDK)/systems/bde $(SDK_DEV_INSTALL_DIR)
	cp $(SDK)/RELEASE $(SDK_DEV_INSTALL_DIR)
	mkdir -p $(SDK_DEV_INSTALL_DIR)/src/appl
	cp -R $(SDK)/src/appl/cint $(SDK_DEV_INSTALL_DIR)/src/appl
	mkdir -p $(SDK_DEV_INSTALL_DIR)/build/switchlight/powerpc/release
	cp $(SDKBUILD)/libbroadcom-release.so.5.10 $(SDK_DEV_INSTALL_DIR)/build/switchlight/powerpc/release
	cp $(SDKBUILD)/libbroadcom-5.10-release.a $(SDK_DEV_INSTALL_DIR)/build/switchlight/powerpc/release
	cp $(SDKBUILD)/version.o $(SDK_DEV_INSTALL_DIR)/build/switchlight/powerpc/release

.PHONY: override_dh_strip override_dh_link
override_dh_strip:
	dh_strip -plibbroadcom-5.10-release --dbg-package=libbroadcom-5.10-release-dbg

override_dh_link:
	dh_link lib/$(DEB_HOST_GNU_TYPE)/libbroadcom-release.so.5.10 lib/$(DEB_HOST_GNU_TYPE)/libbroadcom.so.5.10

